---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Icon from '../../components/Icon.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths({ paginate }) {
  const blogEntries = await getCollection('blog', ({ data }) => {
    return data.draft !== true;
  });

  blogEntries.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

  return paginate(blogEntries, { pageSize: 6 });
}

const { page } = Astro.props;
---

<BaseLayout title="Blog IA - Guiziweb" description="Découvrez nos articles sur l'intelligence artificielle, les dernières innovations et nos conseils d'experts pour développer votre entreprise.">

    <!-- Articles Section -->
    <section class="pt-24 pb-16 sm:py-24 bg-gray-900" id="articles">
        <div class="container mx-auto px-4 lg:px-8">
            <div class="text-center mb-16">
                <h2 class="text-3xl sm:text-4xl lg:text-5xl font-bold text-gray-100 mb-6">
                    Nos <span class="text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-cyan-400">Articles</span>
                </h2>
                <p class="text-lg text-gray-400 max-w-2xl mx-auto">
                    Guides pratiques, analyses techniques et retours d'expérience sur l'IA en entreprise
                </p>
            </div>

            {page.data.length === 0 ? (
                <div class="text-center py-12">
                    <Icon name="fa-file-alt" class="text-gray-600 mb-6" size={96} />
                    <h3 class="text-2xl font-bold text-gray-300 mb-4">Articles en préparation</h3>
                    <p class="text-gray-500">Nos experts préparent du contenu exclusif sur l'IA.</p>
                </div>
            ) : (
                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                    {page.data.map((post) => (
                        <a href={`/blog/${post.slug}`} class="block group">
                            <article class="bg-gray-800/50 backdrop-blur-sm rounded-2xl border border-gray-700/50 hover:border-blue-500/50 transition-all duration-300 overflow-hidden hover:transform hover:scale-105 h-full">
                                {post.data.heroImage && (
                                    <div class="aspect-video bg-gradient-to-br from-blue-500/20 to-purple-500/20 relative overflow-hidden">
                                        <img
                                            src={post.data.heroImage}
                                            alt={post.data.title}
                                            class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500"
                                        />
                                        <div class="absolute inset-0 bg-gradient-to-t from-gray-900/60 to-transparent"></div>
                                    </div>
                                )}

                                <div class="p-6">
                                    <div class="flex items-center text-sm text-gray-400 mb-4">
                                        <Icon name="fa-calendar" class="mr-2 text-blue-400" />
                                        <time>{post.data.pubDate.toLocaleDateString('fr-FR', {
                                            year: 'numeric',
                                            month: 'long',
                                            day: 'numeric'
                                        })}</time>
                                        <span class="mx-2">•</span>
                                        <Icon name="fa-user" class="mr-1 text-cyan-400" />
                                        <span>{post.data.author}</span>
                                    </div>

                                    <h2 class="text-xl font-bold text-gray-100 mb-3 overflow-hidden group-hover:text-blue-400 transition-colors duration-300" style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;">
                                        {post.data.title}
                                    </h2>

                                    <p class="text-gray-400 mb-4 overflow-hidden" style="display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical;">
                                        {post.data.description}
                                    </p>

                                    {post.data.tags.length > 0 && (
                                        <div class="flex flex-wrap gap-2 mb-4">
                                            {post.data.tags.map((tag) => (
                                                <span class="px-3 py-1 bg-blue-500/10 text-blue-400 text-sm rounded-full border border-blue-500/20">
                                                    #{tag}
                                                </span>
                                            ))}
                                        </div>
                                    )}

                                    <span class="inline-flex items-center text-blue-400 hover:text-cyan-400 font-medium transition-all duration-300 group-hover:translate-x-1">
                                        Lire l'article
                                        <Icon name="fa-arrow-right" class="ml-2 transition-transform duration-300 group-hover:translate-x-1" />
                                    </span>
                                </div>
                            </article>
                        </a>
                    ))}
                </div>

                <!-- Navigation pagination -->
                {page.lastPage > 1 && (
                    <nav class="mt-12 flex justify-center items-center space-x-4">
                        {page.url.prev && (
                            <a
                                href={page.url.prev}
                                class="px-4 py-2 bg-gray-800 text-blue-400 rounded-lg hover:bg-gray-700 transition-colors duration-200 flex items-center"
                            >
                                <Icon name="fa-chevron-left" class="mr-2" />
                                Précédent
                            </a>
                        )}

                        <div class="flex items-center space-x-2">
                            {Array.from({ length: page.lastPage }, (_, i) => i + 1).map((pageNum) => (
                                <a
                                    href={pageNum === 1 ? '/blog/' : `/blog/${pageNum}/`}
                                    class={`w-10 h-10 flex items-center justify-center rounded-lg transition-colors duration-200 ${
                                        pageNum === page.currentPage
                                            ? 'bg-blue-600 text-white'
                                            : 'bg-gray-800 text-gray-400 hover:bg-gray-700 hover:text-blue-400'
                                    }`}
                                >
                                    {pageNum}
                                </a>
                            ))}
                        </div>

                        {page.url.next && (
                            <a
                                href={page.url.next}
                                class="px-4 py-2 bg-gray-800 text-blue-400 rounded-lg hover:bg-gray-700 transition-colors duration-200 flex items-center"
                            >
                                Suivant
                                <Icon name="fa-chevron-right" class="ml-2" />
                            </a>
                        )}
                    </nav>
                )}
            )}
        </div>
    </section>

    <!-- CTA Section -->
    <section class="py-16 sm:py-24 bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900" id="blog-cta">
        <div class="container mx-auto px-4 lg:px-8 text-center">
            <div class="max-w-3xl mx-auto">
                <h2 class="text-3xl sm:text-4xl lg:text-5xl font-bold text-gray-100 mb-6">
                    Besoin d'une <span class="text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-cyan-400">Solution IA</span> ?
                </h2>
                <p class="text-lg text-gray-400 mb-8">
                    Discutons de votre projet et découvrons ensemble comment l'IA peut transformer votre entreprise.
                </p>
                <a href="/" class="inline-block bg-gradient-to-r from-blue-600 to-blue-500 text-white px-8 py-4 rounded-lg font-semibold hover:from-blue-700 hover:to-blue-600 transition-all duration-300 shadow-lg hover:shadow-blue-500/25">
                    <Icon name="fa-calendar-alt" class="mr-2" />
                    Réserver un appel gratuit
                </a>
            </div>
        </div>
    </section>

</BaseLayout>