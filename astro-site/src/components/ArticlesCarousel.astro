---
// Imports des styles Swiper
import 'swiper/css';
import 'swiper/css/navigation';
import 'swiper/css/pagination';

export interface Props {
  articles: any[];
}

const { articles } = Astro.props;
---

{articles.length > 0 ? (
<!-- Carrousel Swiper -->
<div class="relative">
    <!-- Navigation Buttons - Responsive -->
    <button class="prev-btn absolute left-2 md:left-0 md:-translate-x-6 top-1/2 -translate-y-1/2 z-20 w-10 h-10 md:w-12 md:h-12 bg-blue-600 hover:bg-blue-700 text-white rounded-full flex items-center justify-center transition-all duration-300 shadow-lg">
        <svg class="w-4 h-4 md:w-5 md:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
        </svg>
    </button>

    <button class="next-btn absolute right-2 md:right-0 md:translate-x-6 top-1/2 -translate-y-1/2 z-20 w-10 h-10 md:w-12 md:h-12 bg-blue-600 hover:bg-blue-700 text-white rounded-full flex items-center justify-center transition-all duration-300 shadow-lg">
        <svg class="w-4 h-4 md:w-5 md:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
        </svg>
    </button>

    <!-- Swiper Container -->
    <div class="swiper articles-swiper">
        <div class="swiper-wrapper">
            {articles.map((article) => (
                <div class="swiper-slide h-auto">
                    <div class="bg-gray-800/50 backdrop-blur-sm rounded-xl p-6 shadow-xl border border-gray-700 hover:border-blue-500/50 transition-all duration-300 h-[320px] flex flex-col">
                        <!-- Contenu fixe -->
                        <div class="flex items-center text-sm text-gray-400 mb-3">
                            <i class="fas fa-calendar mr-2 text-blue-400"></i>
                            <time datetime={article.data.pubDate.toISOString()}>
                                {article.data.pubDate.toLocaleDateString('fr-FR', {
                                    year: 'numeric',
                                    month: 'long',
                                    day: 'numeric'
                                })}
                            </time>
                        </div>

                        <h3 class="text-xl font-bold text-gray-100 mb-3 leading-tight line-clamp-2">
                            <a href={`/blog/${article.slug}/`} class="hover:text-blue-400 transition-colors">
                                {article.data.title}
                            </a>
                        </h3>

                        <p class="text-gray-300 text-sm leading-relaxed flex-grow line-clamp-3 mb-4">
                            {article.data.description}
                        </p>

                        <!-- Footer toujours en bas -->
                        <div class="flex items-center justify-between mt-auto pt-3 border-t border-gray-700/50">
                                <div class="flex items-center text-sm text-gray-400">
                                    <i class="fas fa-user mr-2 text-blue-400"></i>
                                    <span>{article.data.author}</span>
                                </div>

                                <a
                                    href={`/blog/${article.slug}/`}
                                    class="inline-flex items-center text-blue-400 hover:text-blue-300 text-sm font-medium transition-colors"
                                >
                                    Lire la suite
                                    <i class="fas fa-arrow-right ml-2"></i>
                                </a>
                        </div>
                    </div>
                </div>
            ))}
        </div>

        <!-- Pagination dots -->
        <div class="swiper-pagination !bottom-0 !relative !mt-8"></div>
    </div>
</div>
) : (
<!-- État vide - Articles en préparation -->
<div class="flex flex-col items-center justify-center py-16 px-6">
    <div class="bg-gradient-to-br from-blue-900/20 to-cyan-900/20 backdrop-blur-sm rounded-2xl p-8 border border-blue-600/30 text-center max-w-2xl mx-auto">
        <!-- Icône animée -->
        <div class="mb-6">
            <div class="relative inline-block">
                <i class="fas fa-robot text-5xl text-blue-400 opacity-80"></i>
                <div class="absolute -top-2 -right-2 w-4 h-4 bg-blue-500 rounded-full animate-pulse"></div>
            </div>
        </div>

        <!-- Titre -->
        <h3 class="text-2xl font-bold text-gray-100 mb-4">
            Articles en préparation
        </h3>

        <!-- Description -->
        <p class="text-gray-300 mb-6 leading-relaxed">
            Nos experts préparent du contenu exclusif sur l'IA, l'automatisation et la transformation digitale.
        </p>

        <!-- CTA subtil -->
        <div class="mt-8">
            <a href="#calendly-widget" class="inline-flex items-center text-blue-400 hover:text-blue-300 text-sm font-medium transition-colors group">
                En attendant, parlons de votre projet
                <i class="fas fa-arrow-right ml-2 transition-transform group-hover:translate-x-1"></i>
            </a>
        </div>
    </div>
</div>
)}

<script>
// Attendre que le DOM soit chargé
document.addEventListener('DOMContentLoaded', async function() {
    const swiperElement = document.querySelector('.articles-swiper');
    if (swiperElement) {
        try {
            // Import selon la doc officielle
            const Swiper = (await import('swiper')).default;
            const { Navigation, Pagination, Autoplay } = await import('swiper/modules');

            new Swiper('.articles-swiper', {
                modules: [Navigation, Pagination, Autoplay],
                slidesPerView: 1,
                spaceBetween: 16,
                slidesPerGroup: 1,
                centeredSlides: false,
                navigation: {
                    nextEl: '.next-btn',
                    prevEl: '.prev-btn',
                },
                pagination: {
                    el: '.swiper-pagination',
                    clickable: true,
                },
                breakpoints: {
                    640: {
                        spaceBetween: 20,
                    },
                    768: {
                        slidesPerView: 2,
                        slidesPerGroup: 2,
                        spaceBetween: 24,
                    },
                    1024: {
                        slidesPerView: 3,
                        slidesPerGroup: 3,
                        spaceBetween: 24,
                    }
                },
                autoplay: {
                    delay: 6000,
                    disableOnInteraction: false,
                },
                loop: false,
                touchRatio: 1,
                threshold: 10,
                allowTouchMove: true,
            });
        } catch (error) {
            console.error('Erreur lors du chargement de Swiper:', error);
            // Fallback: afficher tous les articles en grille statique
            swiperElement.style.display = 'grid';
            swiperElement.style.gridTemplateColumns = 'repeat(auto-fit, minmax(300px, 1fr))';
            swiperElement.style.gap = '1.5rem';
        }
    }
});
</script>